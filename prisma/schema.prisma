generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  OWNER
  CONSULTANT
  VIEWER
}

enum AssessmentType {
  AI_ADOPTION
  DIGITAL_TRANSFORMATION
}

enum AssessmentDomain {
  STRATEGY
  PROCESS
  DATA
  TECH
  PEOPLE
  GOVERNANCE
  SECURITY
}

enum LeadStatus {
  NEW
  PROSPECTING
  CONVERTED
}

model User {
  id           String            @id @default(uuid())
  email        String            @unique
  passwordHash String
  members      WorkspaceMember[]
  leads        Lead[]
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
}

model Client {
  id          String            @id @default(uuid())
  name        String
  members     WorkspaceMember[]
  assessments Assessment[]
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

model WorkspaceMember {
  id        String   @id @default(uuid())
  userId    String
  clientId  String
  role      Role
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id])
  client Client @relation(fields: [clientId], references: [id])

  @@unique([userId, clientId])
  @@index([userId])
  @@index([clientId])
}

model Assessment {
  id          String                  @id @default(uuid())
  clientId    String
  type        AssessmentType
  createdById String?
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt

  client Client @relation(fields: [clientId], references: [id])
  scores AssessmentDomainScore[]

  @@index([clientId, createdAt])
}

model AssessmentDomainScore {
  id           String           @id @default(uuid())
  assessmentId String
  domain       AssessmentDomain
  score        Int
  notes        String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  assessment Assessment @relation(fields: [assessmentId], references: [id])

  @@unique([assessmentId, domain])
  @@index([assessmentId])
}

model Lead {
  id          String     @id @default(uuid())
  ownerId     String
  name        String
  contact     String
  source      String
  status      LeadStatus @default(NEW)
  convertedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  owner User @relation(fields: [ownerId], references: [id])

  @@index([ownerId, createdAt])
}
